{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Chart with parsed measurement_value Type of workers",
  "data": {
    "name": "geodb_example",
    "values": []
  },
  "mark": "bar",
  "transform": [
    {
      "calculate": "slice(datum.measurement_value, 1, length(datum.measurement_value) - 1)",
      "as": "ref_clean"
    },
    {"calculate": "split(datum.ref_clean, ',')[0]", "as": "National Workers"},
    {"calculate": "split(datum.ref_clean, ',')[1]", "as": "Foreign Workers"},
    {"calculate": "split(datum.ref_clean, ',')[2]", "as": "Unknown"},
    {
      "fold": ["National Workers", "Foreign Workers", "Unknown"],
      "as": ["Type of workers", "value"]
    },
    {"calculate": "toNumber(datum.value)", "as": "numeric_value"}
  ],
  "encoding": {
    "x": {"field": "time", "type": "temporal", "axis": {"format": "%Y-%m-%d"}},
    "y": {
      "field": "numeric_value",
      "type": "quantitative",
      "title": "Number of workers"
    },
    "color": {
      "legend": {
        "orient": "top"
      },
      "field": "Type of workers",
      "type": "nominal",
      "title": "Type of Workers",
      "scale": {
        "domain": [
          "Foreign Workers",
          "National Workers",
          "Unknown"
        ],
        "range": ["#4c78a8", "#f58518", "#e45756"]
      }
    },
    "tooltip": [
      {"field": "time", "type": "temporal", "title": "Date", "format": "%Y-%m-%d"},
      {"field": "Type of workers", "type": "nominal", "title": "Type of Workers"},
      {"field": "numeric_value", "type": "quantitative", "title": "Number of workers"}
    ]
  },
  "params": [
    {
      "name": "highlight",
      "select": {"type": "point", "on": "mouseover", "clear": "mouseout"}
    },
    {"name": "grid", "select": "interval", "bind": "scales"}
  ],
  "background": "transparent"
}
